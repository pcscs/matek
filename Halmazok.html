<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Halmazok (magyar, pontos Venn-diagram)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      font-family: "Fira Sans", Arial, sans-serif;
      background: #eaf6ff;
      color: #1a284f;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode {
      background: #1a284f;
      color: #eaf6ff;
    }
    .theme-switcher {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #08509b;
      float: right;
      margin-top: 0.5em;
      margin-left: 1em;
      transition: color 0.3s;
    }
    .theme-switcher:active {
      color: #f3cb23;
    }
    .dark-mode .theme-switcher {
      color: #f3cb23;
    }
    .math-icon {
      font-size: 2rem;
      line-height: 1;
      margin-right: 10px;
      color: #ffd700;
      vertical-align: middle;
    }
    .dark-mode .math-icon {
      color: #f3cb23;
    }
    .card {
      background: #d2e7fa;
      border: none;
      margin-top: 1.5em;
    }
    .dark-mode .card {
      background: #263a5e;
      color: #eaf6ff;
    }
    a {
      color: #1564b3;
    }
    a:hover {
      color: #f3cb23;
    }
    .dark-mode a {
      color: #f3cb23;
    }
    .dark-mode a:hover {
      color: #8ed6fb;
    }
    /* Venn-diagram canvas */
    #vennCanvas {
      background: #fff;
      border: 1.5px solid #b8d5f9;
      margin-top: 18px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(21,100,179,0.09);
      transition: background 0.3s, border-color 0.3s;
    }
    .dark-mode #vennCanvas {
      background: #1a284f;
      border-color: #08509b;
    }
    .error {
      color: #c2001a;
      font-weight: bold;
      margin-top: 10px;
    }
    .dark-mode .error {
      color: #ff6f61;
    }
    .form-label {
      font-weight: 500;
      margin-top: 10px;
      color: inherit;
    }
    textarea.form-control {
      font-size: 1.1em;
    }
    .op-group label {
      margin-right: 18px;
    }
    .btn-calc {
      font-size: 1.15em;
      margin-top: 12px;
      background: #1564b3;
      color: #fff;
      border-radius: 8px;
      border: none;
      box-shadow: 0 2px 8px rgba(21,100,179,0.09);
      transition: background 0.3s, color 0.3s;
    }
    .btn-calc:hover, .btn-calc:focus {
      background: #08509b;
      color: #f3cb23;
    }
    .dark-mode .btn-calc {
      background: #263a5e;
      color: #f3cb23;
    }
    .dark-mode .btn-calc:hover, .dark-mode .btn-calc:focus {
      background: #08509b;
      color: #ffd700;
    }
    #result {
      font-size: 1.15em;
      margin-top: 14px;
      font-weight: 500;
      color: #1564b3;
    }
    .dark-mode #result {
      color: #f3cb23;
    }
    @media (max-width: 600px) {
      #vennCanvas {
        width: 100% !important;
        height: 220px !important;
      }
    }
  </style>
</head>
<body>
  <div class="container py-3">
    <button class="theme-switcher" id="themeBtn" onclick="toggleTheme()" title="Sötét/Világos váltás">
      <!-- Nap ikon (alapértelmezett) -->
      <span id="icon-sun" style="display:inline;">
        <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
          <g>
            <line x1="12" y1="1" x2="12" y2="4" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="20" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="4.22" x2="6.34" y2="6.34" stroke="currentColor" stroke-width="2"/>
            <line x1="17.66" y1="17.66" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
            <line x1="1" y1="12" x2="4" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="20" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="19.78" x2="6.34" y2="17.66" stroke="currentColor" stroke-width="2"/>
            <line x1="17.66" y1="6.34" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
          </g>
        </svg>
      </span>
      <!-- Hold ikon (sötét mód) -->
      <span id="icon-moon" style="display:none;">
        <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 0111.21 3a1 1 0 00-1.12 1.24A7 7 0 0012 21a7 7 0 009.76-8.67 1 1 0 00-1.24-1.12z" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </span>
    </button>
    <div class="d-flex align-items-center mb-3">
      <span class="math-icon">∈</span>
      <h1 class="text-primary mb-0">Halmazok</h1>
      <span class="math-icon">∪</span>
      <span class="math-icon">∩</span>
    </div>
    <div class="card p-4 shadow-sm">
      <form id="halmazForm" autocomplete="off" onsubmit="return false;">
        <div class="mb-3">
          <label for="setU" class="form-label">Alaphalmaz (U)</label>
          <textarea id="setU" class="form-control" placeholder="alma, körte, banán, narancs, szilva"></textarea>
        </div>
        <div class="mb-3">
          <label for="setA" class="form-label">A halmaz</label>
          <textarea id="setA" class="form-control" placeholder="alma, körte, banán"></textarea>
        </div>
        <div class="mb-3">
          <label for="setB" class="form-label">B halmaz</label>
          <textarea id="setB" class="form-control" placeholder="banán, narancs"></textarea>
        </div>
        <div class="mb-2 op-group">
          <label><input type="radio" name="op" value="union" checked> Egyesítés (A ∪ B)</label>
          <label><input type="radio" name="op" value="intersection"> Metszet (A ∩ B)</label>
          <label><input type="radio" name="op" value="diffAB"> Különbség (A \ B)</label>
          <label><input type="radio" name="op" value="diffBA"> Különbség (B \ A)</label>
          <label><input type="radio" name="op" value="symdiff"> Szimmetrikus különbség (A △ B)</label>
          <label><input type="radio" name="op" value="compA"> Komplementer (A')</label>
          <label><input type="radio" name="op" value="compB"> Komplementer (B')</label>
        </div>
        <button type="button" class="btn btn-calc" id="compute">Számol + Rajzol</button>
      </form>
      <div id="error" class="error"></div>
      <div id="result"></div>
      <canvas id="vennCanvas" width="500" height="300"></canvas>
    </div>
  </div>
  <script>
    // Sötét/világos téma váltó
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      document.getElementById('icon-sun').style.display = isDark ? 'none' : 'inline';
      document.getElementById('icon-moon').style.display = isDark ? 'inline' : 'none';
      drawVennFromInputs();
    }
    window.onload = function() {
      if(window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
        document.getElementById('icon-sun').style.display = 'none';
        document.getElementById('icon-moon').style.display = 'inline';
      }
      drawVennFromInputs();
    };

    // HALMAZ MŰVELETEK
    function parseElements(txt){return txt.split(/[,;]+/).map(s=>s.trim()).filter(Boolean).filter((v,i,a)=>a.indexOf(v)===i);}
    const union=(a,b)=>[...new Set([...a,...b])];
    const intersection=(a,b)=>a.filter(x=>b.includes(x));
    const difference=(a,b)=>a.filter(x=>!b.includes(x));
    const symdiff=(a,b)=>union(difference(a,b),difference(b,a));
    const complement=(u,a)=>difference(u,a);

    function drawVenn(U,A,B){
      const ctx=document.getElementById('vennCanvas').getContext('2d');
      ctx.clearRect(0,0,500,300);
      // Sötét/világos mód színei
      const isDark=document.body.classList.contains('dark-mode');
      const bg = isDark ? "#1a284f" : "#fff";
      ctx.fillStyle=bg;
      ctx.fillRect(0,0,500,300);

      const ax=200, ay=150, bx=300, by=150, r=100;
      ctx.globalAlpha=0.23; ctx.fillStyle=isDark?'#e34a4a':'red'; ctx.beginPath(); ctx.arc(ax,ay,r,0,2*Math.PI); ctx.fill();
      ctx.fillStyle=isDark?'#53a6e3':'blue'; ctx.beginPath(); ctx.arc(bx,by,r,0,2*Math.PI); ctx.fill();
      ctx.globalAlpha=1; ctx.font='15px "Fira Sans", Arial, sans-serif'; ctx.fillStyle=isDark?'#fff':'#1a284f';

      const onlyA=difference(A,B);
      const onlyB=difference(B,A);
      const both=intersection(A,B);
      const outside=difference(U,union(A,B));

      onlyA.forEach((el,i)=>ctx.fillText(el, ax-70, ay-30+i*17));
      both.forEach((el,i)=>ctx.fillText(el, ax+15, ay-30+i*17));
      onlyB.forEach((el,i)=>ctx.fillText(el, bx+50, by-30+i*17));
      outside.forEach((el,i)=>ctx.fillText(el, 20, 30+i*17));

      ctx.font='bold 17px "Fira Sans", Arial, sans-serif';
      ctx.fillText('A', ax-10, ay-110);
      ctx.fillText('B', bx-10, by-110);
      ctx.font='italic 14px "Fira Sans", Arial, sans-serif';
      ctx.fillText('U \\ (A∪B)', 20, 20);
    }

    function filterByU(set, U){
      return set.filter(x=>U.includes(x));
    }

    function drawVennFromInputs() {
      const U=parseElements(document.getElementById('setU').value);
      let A=parseElements(document.getElementById('setA').value);
      let B=parseElements(document.getElementById('setB').value);

      A=filterByU(A,U);
      B=filterByU(B,U);
      drawVenn(U,A,B);
    }

    document.getElementById('compute').addEventListener('click',()=>{
      const U=parseElements(document.getElementById('setU').value);
      let A=parseElements(document.getElementById('setA').value);
      let B=parseElements(document.getElementById('setB').value);

      // Ellenőrzés és szűrés
      const invalidA=A.filter(x=>!U.includes(x));
      const invalidB=B.filter(x=>!U.includes(x));
      if(invalidA.length || invalidB.length){
        document.getElementById('error').textContent=`Hiba: Csak az alaphalmaz elemei adhatók meg. (Hibás A elemek: ${invalidA.join(', ')}; Hibás B elemek: ${invalidB.join(', ')})`;
        document.getElementById('result').textContent='';
        drawVenn(U,filterByU(A,U),filterByU(B,U));
        return;
      } else {
        document.getElementById('error').textContent='';
      }

      A=filterByU(A,U);
      B=filterByU(B,U);

      const op=document.querySelector('input[name="op"]:checked').value;
      let res=[];
      if(op==='union') res=union(A,B);
      else if(op==='intersection') res=intersection(A,B);
      else if(op==='diffAB') res=difference(A,B);
      else if(op==='diffBA') res=difference(B,A);
      else if(op==='symdiff') res=symdiff(A,B);
      else if(op==='compA') res=complement(U,A);
      else if(op==='compB') res=complement(U,B);
      document.getElementById('result').textContent=res.length?res.join(', '):'∅';
      drawVenn(U,A,B);
    });

    // Ha mezőt szerkeszt, újra rajzoljuk a Venn-diagramot
    ['setU','setA','setB'].forEach(id=>{
      document.getElementById(id).addEventListener('input',drawVennFromInputs);
    });
  </script>
</body>
</html>