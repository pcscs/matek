<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>T√∂rtek m≈±veletei (alap, halad√≥, eg√©sz sz√°mokkal, s√∂t√©t/vil√°gos t√©m√°val)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      min-height: 100%;
      height: 100%;
      background: #eaf6ff;
      color: #1a284f;
      font-family: "Fira Sans", Arial, sans-serif;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode, html.dark-mode {
      background: #1a284f !important;
      color: #eaf6ff;
    }
    .theme-switcher {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #1564b3;
      float: right;
      margin-top: 0.5em;
      margin-left: 1em;
      transition: color 0.3s;
    }
    .theme-switcher:active {
      color: #f3cb23;
    }
    .dark-mode .theme-switcher {
      color: #f3cb23;
    }
    .math-icon {
      font-size: 2rem;
      line-height: 1;
      margin-right: 10px;
      color: #ffd700;
      vertical-align: middle;
    }
    .dark-mode .math-icon {
      color: #f3cb23;
    }
    .card {
      background: #d2e7fa;
      border: none;
      margin-top: 2em;
    }
    .dark-mode .card {
      background: #263a5e;
      color: #eaf6ff;
    }
    .input-number, .input-expression {
      font-size: 1.1em;
      background: #fff;
      color: #1a284f;
      border: 1.5px solid #b8d5f9;
      border-radius: 8px;
      padding: 0.5em 0.8em;
      margin-bottom: 0.5em;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode .input-number, .dark-mode .input-expression {
      background: #1a284f;
      color: #eaf6ff;
      border-color: #08509b;
    }
    .btn-math {
      font-size: 1.15em;
      background: #1564b3;
      color: #fff;
      border-radius: 8px;
      border: none;
      margin-top: 0.8em;
      box-shadow: 0 2px 8px rgba(21,100,179,0.09);
      transition: background 0.3s, color 0.3s;
    }
    .btn-math:hover, .btn-math:focus {
      background: #08509b;
      color: #f3cb23;
    }
    .dark-mode .btn-math {
      background: #263a5e;
      color: #f3cb23;
    }
    .dark-mode .btn-math:hover, .dark-mode .btn-math:focus {
      background: #08509b;
      color: #ffd700;
    }
    .switch-label {
      font-size: 1em;
      color: #1564b3;
      font-weight: 500;
      margin-bottom: 0.2em;
    }
    .dark-mode .switch-label {
      color: #ffd700;
    }
    .switch-toggle {
      width: 46px;
      height: 26px;
      position: relative;
      display: inline-block;
      vertical-align: middle;
      margin: 0 10px;
    }
    .switch-toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #b8d5f9;
      transition: .4s;
      border-radius: 26px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background: #fff;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background: #08509b;
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    .dark-mode .slider {
      background: #08509b;
    }
    .dark-mode .slider:before {
      background: #ffd700;
    }
    #steps {
      margin-top: 28px;
      padding-top: 16px;
      border-top: 2px solid #b8d5f9;
    }
    .dark-mode #steps {
      border-top: 2px solid #08509b;
    }
    .step-box {
      padding: 1em;
      background: #f7f8fa;
      border-radius: 8px;
      margin-bottom: 1em;
      color: #1a284f;
      border-left: 4px solid #1564b3;
    }
    .dark-mode .step-box {
      background: #263a5e;
      color: #eaf6ff;
      border-left: 4px solid #ffd700;
    }
    .result-box {
      padding: 1em;
      background: #1564b3;
      color: #fff;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 1em;
    }
    .dark-mode .result-box {
      background: #ffd700;
      color: #1a284f;
    }
    .fraction-display {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      line-height: 1;
      margin: 0 8px;
    }
    .fraction-line {
      width: 100%;
      border-bottom: 2px solid;
      margin: 2px 0;
      transition: border-color 0.3s ease;
    }
    .step-container {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      flex-wrap: wrap;
    }
    .error-box {
      color: #c2001a;
      font-weight: bold;
      padding: 1em;
      background: #ffe3e3;
      border-radius: 8px;
      margin-bottom: 1em;
    }
    .dark-mode .error-box {
      color: #ff6f61;
      background: #2d1a2a;
    }
  </style>
</head>
<body>
  <div class="container py-3">
    <button class="theme-switcher" id="themeBtn" onclick="toggleTheme()" title="S√∂t√©t/Vil√°gos v√°lt√°s">
      <span id="icon-sun" style="display:inline;">
        <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
          <g>
            <line x1="12" y1="1" x2="12" y2="4" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="20" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="4.22" x2="6.34" y2="6.34" stroke="currentColor" stroke-width="2"/>
            <line x1="17.66" y1="17.66" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
            <line x1="1" y1="12" x2="4" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="20" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="4.22" y1="19.78" x2="6.34" y2="17.66" stroke="currentColor" stroke-width="2"/>
            <line x1="17.66" y1="6.34" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
          </g>
        </svg>
      </span>
      <span id="icon-moon" style="display:none;">
        <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 0111.21 3a1 1 0 00-1.12 1.24A7 7 0 0012 21a7 7 0 009.76-8.67 1 1 0 00-1.24-1.12z" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </span>
    </button>
    <div class="d-flex align-items-center mb-3">
      <span class="math-icon">ùë•</span>
      <h1 class="math-title mb-0">T√∂rtek m≈±veletei</h1>
      <span class="math-icon">√∑</span>
      <span class="math-icon">+</span>
      <span class="math-icon">-</span>
    </div>
    <div class="card p-4 shadow-sm mx-auto" style="max-width: 700px;">
      <div class="d-flex align-items-center justify-content-center mb-3">
        <span class="switch-label me-2">Alap m√≥d</span>
        <label class="switch-toggle">
          <input type="checkbox" id="mode-toggle" onchange="toggleMode()">
          <span class="slider"></span>
        </label>
        <span class="switch-label ms-2">Halad√≥ m√≥d</span>
      </div>
      <div id="basic-mode-inputs">
        <div class="row mb-3 g-2 justify-content-center">
          <div class="col-6 col-md-3 text-center">
            <input type="number" id="numerator1" placeholder="Sz√°ml√°l√≥" value="2" class="input-number mb-1 w-100">
            <div><hr id="hr1" style="margin:2px 0;border-top:2px solid #1564b3;"></div>
            <input type="number" id="denominator1" placeholder="Nevez≈ë" value="8" class="input-number w-100">
          </div>
          <div class="col-auto d-flex align-items-center justify-content-center">
            <select id="operation" class="input-number bg-white text-dark w-auto">
              <option value="add">+</option>
              <option value="subtract">-</option>
              <option value="multiply">*</option>
              <option value="divide">/</option>
            </select>
          </div>
          <div class="col-6 col-md-3 text-center">
            <input type="number" id="numerator2" placeholder="Sz√°ml√°l√≥" value="1" class="input-number mb-1 w-100">
            <div><hr id="hr2" style="margin:2px 0;border-top:2px solid #1564b3;"></div>
            <input type="number" id="denominator2" placeholder="Nevez≈ë" value="4" class="input-number w-100">
          </div>
        </div>
      </div>
      <div id="advanced-mode-input" class="d-none mb-3">
        <input type="text" id="advanced-expression" placeholder="√çrd be a kifejez√©st, pl: 1/2 + 3/4" value="(2/8-1/4)*(1/7-1/2)-2" class="input-expression w-100 mb-2">
      </div>
      <button onclick="calculate()" type="button" class="btn btn-math w-100 mb-3">Sz√°m√≠t√°s ind√≠t√°sa</button>
      <div id="steps"></div>
    </div>
    <div class="mt-4 text-center">
      <p class="mt-4 text-sm text-secondary">Csongor</p>
    </div>
  </div>
  <script>
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      document.documentElement.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      document.getElementById('icon-sun').style.display = isDark ? 'none' : 'inline';
      document.getElementById('icon-moon').style.display = isDark ? 'inline' : 'none';
    }
    window.onload = function() {
      if(window.parent && window.parent.document && window.parent.document.body.classList.contains('dark-mode')) {
        document.body.classList.add('dark-mode');
        document.documentElement.classList.add('dark-mode');
        document.getElementById('icon-sun').style.display = 'none';
        document.getElementById('icon-moon').style.display = 'inline';
      }
    };
    // --- A sz√°m√≠t√°si logika az eredeti JS-b≈ël j√∂n, a f≈ë l√©nyege: ---
    // gcd, lcm, simplify, createFractionElement, createOperationElement, createTextElement, createExpressionElement
    // ... majd a calculate, calculateBasic, calculateAdvanced, displaySteps, updateStepsTheme, stb.
    // --- Ide illeszthet≈ë az eredeti script teljesen ---
	
	// T√∂rt m≈±veletek seg√©df√ºggv√©nyek
    function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }
    function lcm(a, b) { if (a === 0 || b === 0) return 0; return Math.abs(a * b) / gcd(a, b); }
    function simplify(numerator, denominator) {
      if (denominator === 0) throw new Error('A nevez≈ë nem lehet nulla!');
      if (numerator === 0) return [0, 1];
      const commonDivisor = gcd(Math.abs(numerator), Math.abs(denominator));
      const simplifiedNumerator = numerator / commonDivisor;
      const simplifiedDenominator = denominator / commonDivisor;
      if (simplifiedDenominator < 0) return [-simplifiedNumerator, -simplifiedDenominator];
      return [simplifiedNumerator, simplifiedDenominator];
    }

    // Frakci√≥ megjelen√≠t√©s
    function createFractionElement(numerator, denominator) {
      const fractionDiv = document.createElement('div');
      fractionDiv.className = 'fraction-display';
      fractionDiv.innerHTML = `<span class="fraction-text">${numerator}</span><span class="fraction-line"></span><span class="fraction-text">${denominator}</span>`;
      return fractionDiv;
    }
    function createOperationElement(operation) {
      const opMap = { 'add': '+', 'subtract': '-', 'multiply': '√ó', 'divide': '√∑', '+': '+', '-': '-', '*': '√ó', '/': '√∑', '=': '=' };
      const opSpan = document.createElement('span');
      opSpan.className = 'text-3xl font-light mx-2';
      opSpan.textContent = opMap[operation] || operation;
      return opSpan;
    }
    function createTextElement(text) {
      const textNode = document.createElement('span');
      textNode.textContent = text;
      textNode.className = 'text-3xl mx-1';
      return textNode;
    }
    function createExpressionElement(expression) {
      const expressionDiv = document.createElement('div');
      expressionDiv.className = 'step-container';
      expression.forEach(part => {
        if (typeof part === 'string') {
          if (['+', '-', '*', '/', '='].includes(part)) {
            expressionDiv.appendChild(createOperationElement(part));
          } else if (part === '(' || part === ')') {
            expressionDiv.appendChild(createTextElement(part));
          } else {
            expressionDiv.appendChild(createTextElement(part));
          }
        } else {
          expressionDiv.appendChild(createFractionElement(part.num, part.den));
        }
      });
      return expressionDiv;
    }
    async function displaySteps(steps) {
      const stepsContainer = document.getElementById('steps');
      stepsContainer.innerHTML = '';
      const isDarkMode = document.body.classList.contains('dark-mode');
      for (const step of steps) {
        const stepDiv = document.createElement('div');
        stepDiv.className = `step-box${step.isError ? ' error-box' : ''}`;
        if (step.text) {
          const textDiv = document.createElement('div');
          textDiv.className = 'mb-2';
          textDiv.innerHTML = step.text;
          stepDiv.appendChild(textDiv);
        }
        if (step.visual) {
          const visualDiv = document.createElement('div');
          visualDiv.className = 'step-container';
          if(step.visual.expression) {
            const expressionElement = createExpressionElement(step.visual.expression);
            visualDiv.appendChild(expressionElement);
          }
          stepDiv.appendChild(visualDiv);
        }
        stepsContainer.appendChild(stepDiv);
        await new Promise(resolve => setTimeout(resolve, 300));
      }
      updateStepsTheme(isDarkMode);
    }
    let lastSteps = null;

    async function calculate() {
      const modeToggle = document.getElementById('mode-toggle');
      if (modeToggle.checked) {
        await calculateAdvanced();
      } else {
        await calculateBasic();
      }
    }
    async function calculateBasic() {
      let numerator1 = parseInt(document.getElementById('numerator1').value);
      let denominator1 = parseInt(document.getElementById('denominator1').value);
      let numerator2 = parseInt(document.getElementById('numerator2').value);
      let denominator2 = parseInt(document.getElementById('denominator2').value);
      const operation = document.getElementById('operation').value;
      if (isNaN(numerator1) || isNaN(denominator1) || isNaN(numerator2) || isNaN(denominator2) || denominator1 === 0 || denominator2 === 0) {
        lastSteps = [{text:'K√©rj√ºk, √©rv√©nyes sz√°mokat adj meg! A nevez≈ë nem lehet nulla.',isError:true}];
        displaySteps(lastSteps);
        return;
      }
      if (operation === 'divide' && numerator2 === 0) {
        lastSteps = [{text:'Null√°val nem lehet osztani!',isError:true}];
        displaySteps(lastSteps);
        return;
      }
      const steps = [];
      let resultNumerator, resultDenominator;
      const opMap = { 'add': '+', 'subtract': '-', 'multiply': '√ó', 'divide': '√∑' };
      const initialExpression = [{num:numerator1,den:denominator1}, opMap[operation], {num:numerator2,den:denominator2}];
      steps.push({text:'Kiindul√≥ feladat:',visual:{expression:initialExpression}});
      const [simplifiedNum1, simplifiedDen1] = simplify(numerator1, denominator1);
      if (simplifiedNum1 !== numerator1 || simplifiedDen1 !== denominator1) {
        steps.push({text:'Egyszer≈±s√≠tj√ºk az els≈ë t√∂rtet:',visual:{expression:[{num:numerator1,den:denominator1},'=',{num:simplifiedNum1,den:simplifiedDen1}]}});
        numerator1 = simplifiedNum1; denominator1 = simplifiedDen1;
      }
      const [simplifiedNum2, simplifiedDen2] = simplify(numerator2, denominator2);
      if (simplifiedNum2 !== numerator2 || simplifiedDen2 !== denominator2) {
        steps.push({text:'Egyszer≈±s√≠tj√ºk a m√°sodik t√∂rtet:',visual:{expression:[{num:numerator2,den:denominator2},'=',{num:simplifiedNum2,den:simplifiedDen2}]}});
        numerator2 = simplifiedNum2; denominator2 = simplifiedDen2;
      }
      if (simplifiedNum1 !== parseInt(document.getElementById('numerator1').value) || simplifiedDen1 !== parseInt(document.getElementById('denominator1').value) || simplifiedNum2 !== parseInt(document.getElementById('numerator2').value) || simplifiedDen2 !== parseInt(document.getElementById('denominator2').value)) {
        steps.push({text:'Az egyszer≈±s√≠t√©s ut√°n a feladat:',visual:{expression:[{num:numerator1,den:denominator1},opMap[operation],{num:numerator2,den:denominator2}]}});
      }
      switch (operation) {
        case 'add':
        case 'subtract':
          let commonDenominator = lcm(denominator1, denominator2);
          let newNumerator1 = numerator1; let newNumerator2 = numerator2;
          let explanationText = "";
          if (denominator1 % denominator2 === 0) {
            const multiplier = denominator1 / denominator2;
            newNumerator2 = numerator2 * multiplier;
            commonDenominator = denominator1;
            explanationText = `Mivel az els≈ë t√∂rt nevez≈ëje, ${denominator1}, oszthat√≥ a m√°sodik nevez≈ëvel, ${denominator2}-vel, elegend≈ë csak a m√°sodik t√∂rtet b≈ëv√≠teni. A k√∂z√∂s nevez≈ë: ${commonDenominator}`;
          } else if (denominator2 % denominator1 === 0) {
            const multiplier = denominator2 / denominator1;
            newNumerator1 = numerator1 * multiplier;
            commonDenominator = denominator2;
            explanationText = `Mivel a m√°sodik t√∂rt nevez≈ëje, ${denominator2}, oszthat√≥ az els≈ë nevez≈ëvel, ${denominator1}-gyel, elegend≈ë csak az els≈ë t√∂rtet b≈ëv√≠teni. A k√∂z√∂s nevez≈ë: ${commonDenominator}`;
          } else {
            const multiplier1 = commonDenominator / denominator1;
            const multiplier2 = commonDenominator / denominator2;
            newNumerator1 = numerator1 * multiplier1;
            newNumerator2 = numerator2 * multiplier2;
            explanationText = `M≈±velet elv√©gz√©s√©hez k√∂z√∂s nevez≈ëre hozzuk a t√∂rteket. A k√∂z√∂s nevez≈ë a nevez≈ëk legkisebb k√∂z√∂s t√∂bbsz√∂r√∂se, ami ${commonDenominator}.`;
          }
          steps.push({text:explanationText,visual:{expression:[{num:newNumerator1,den:commonDenominator},opMap[operation],{num:newNumerator2,den:commonDenominator}]}});
          if (operation === 'add') {
            resultNumerator = newNumerator1 + newNumerator2;
            steps.push({text:'√ñsszead√°s: a sz√°ml√°l√≥kat √∂sszeadjuk. A nevez≈ë v√°ltozatlan marad.',visual:{expression:[{num:`${newNumerator1} + ${newNumerator2}`,den:commonDenominator},'=',{num:resultNumerator,den:commonDenominator}]}});
          } else {
            resultNumerator = newNumerator1 - newNumerator2;
            steps.push({text:'Kivon√°s: a sz√°ml√°l√≥kat kivonjuk egym√°sb√≥l. A nevez≈ë v√°ltozatlan marad.',visual:{expression:[{num:`${newNumerator1} - ${newNumerator2}`,den:commonDenominator},'=',{num:resultNumerator,den:commonDenominator}]}});
          }
          resultDenominator = commonDenominator;
          break;
        case 'multiply':
          resultNumerator = numerator1 * numerator2;
          resultDenominator = denominator1 * denominator2;
          steps.push({text:'Szorz√°sn√°l a sz√°ml√°l√≥kat √©s a nevez≈ëket k√ºl√∂n szorozzuk √∂ssze.',visual:{expression:[{num:numerator1,den:denominator1},'√ó',{num:numerator2,den:denominator2},'=',{num:resultNumerator,den:resultDenominator}]}});
          break;
        case 'divide':
          resultNumerator = numerator1 * denominator2;
          resultDenominator = denominator1 * numerator2;
          steps.push({text:'Oszt√°sn√°l az els≈ë t√∂rtet megszorozzuk a m√°sodik t√∂rt reciprok√°val.',visual:{expression:[{num:numerator1,den:denominator1},'√ó',{num:denominator2,den:numerator2}]}});
          steps.push({text:'Elv√©gezz√ºk a szorz√°st.',visual:{expression:[{num:`${numerator1} √ó ${denominator2}`,den:`${denominator1} √ó ${numerator2}`},'=',{num:resultNumerator,den:resultDenominator}]}});
          break;
      }
      const [simplifiedNumerator, simplifiedDenominator] = simplify(resultNumerator, resultDenominator);
      let finalResultDisplay = {num:simplifiedNumerator,den:simplifiedDenominator};
      if (resultNumerator !== simplifiedNumerator || resultDenominator !== simplifiedDenominator) {
        const commonDivisor = gcd(Math.abs(resultNumerator), Math.abs(resultDenominator));
        steps.push({text:`Az eredm√©nyt egyszer≈±s√≠thetj√ºk a legnagyobb k√∂z√∂s oszt√≥val, ami ${commonDivisor}.`,visual:{expression:[{num:resultNumerator,den:resultDenominator},'=',finalResultDisplay]}});
      }
      steps.push({text:'<span class="fw-bold fs-5">V√©geredm√©ny:</span>',visual:{expression:[finalResultDisplay]}});
      lastSteps = steps;
      await displaySteps(lastSteps);
    }
    async function calculateAdvanced() {
      const expressionStr = document.getElementById('advanced-expression').value.trim();
      const steps = [];
      function tokenize(str) {
        const tokens = [];
        const regex = /(\d+\/\d+)|(\d+)|([+\-*/()])|(\s+)/g;
        let match; let lastIndex = 0;
        while ((match = regex.exec(str)) !== null) {
          if (match.index > lastIndex) throw new Error('√ârv√©nytelen karakter a kifejez√©sben: ' + str.substring(lastIndex, match.index));
          if (match[1]) {
            const [num, den] = match[1].split('/').map(Number);
            if (den === 0) throw new Error('A nevez≈ë nem lehet nulla!');
            tokens.push({ num: num, den: den });
          } else if (match[2]) {
            tokens.push({ num: Number(match[2]), den: 1 });
          } else if (match[3]) {
            tokens.push(match[3]);
          }
          lastIndex = regex.lastIndex;
        }
        if (lastIndex < str.length) throw new Error('√ârv√©nytelen kifejez√©s a v√©g√©n: ' + str.substring(lastIndex));
        const finalTokens = [];
        for (let i = 0; i < tokens.length; i++) {
          finalTokens.push(tokens[i]);
          if (typeof tokens[i] === 'object' && tokens[i+1] === '(') finalTokens.push('*');
          else if (tokens[i] === ')' && typeof tokens[i+1] === 'object') finalTokens.push('*');
        }
        for (let i = 0; i < finalTokens.length - 1; i++) {
          const current = finalTokens[i];
          const next = finalTokens[i + 1];
          if (typeof current === 'object' && typeof next === 'object' && next !== '(') throw new Error('Hi√°nyz√≥ oper√°tor k√©t sz√°m k√∂z√∂tt!');
          if (typeof current === 'string' && ['+', '-', '*', '/'].includes(current) && typeof next === 'string' && ['+', '-', '*', '/'].includes(next)) throw new Error('K√©t oper√°tor nem √°llhat egym√°s mellett!');
        }
        return finalTokens;
      }
      function performOperation(a, op, b) {
        let resultNum, resultDen;
        switch (op) {
          case '+':
            resultNum = a.num * (lcm(a.den, b.den) / a.den) + b.num * (lcm(a.den, b.den) / b.den);
            resultDen = lcm(a.den, b.den);
            break;
          case '-':
            resultNum = a.num * (lcm(a.den, b.den) / a.den) - b.num * (lcm(a.den, b.den) / b.den);
            resultDen = lcm(a.den, b.den);
            break;
          case '*':
            resultNum = a.num * b.num;
            resultDen = a.den * b.den;
            break;
          case '/':
            if (b.num === 0) throw new Error('Null√°val val√≥ oszt√°s!');
            resultNum = a.num * b.den;
            resultDen = a.den * b.num;
            break;
        }
        if (resultDen === 0) throw new Error('A nevez≈ë null√°ra ad√≥dott a m≈±velet sor√°n!');
        const [simplifiedNum, simplifiedDen] = simplify(resultNum, resultDen);
        return { num: simplifiedNum, den: simplifiedDen };
      }
      function getPrecedence(op) { if (op === '*' || op === '/') return 2; if (op === '+' || op === '-') return 1; return 0; }
      function evaluateExpression(tokens, steps) {
        const values = []; const ops = [];
        function applyOp() {
          const op = ops.pop();
          const b = values.pop();
          const a = values.pop();
          const result = performOperation(a, op, b);
          values.push(result);
          steps.push({text:`Elv√©gezz√ºk a(z) '${op}' m≈±veletet:`,visual:{expression:[a,op,b,'=',result]}});
        }
        for (let token of tokens) {
          if (typeof token === 'object') values.push(token);
          else if (token === '(') ops.push(token);
          else if (token === ')') {
            while (ops.length > 0 && ops[ops.length - 1] !== '(') applyOp();
            if (ops.length === 0 || ops[ops.length - 1] !== '(') throw new Error('Helytelen√ºl elhelyezett z√°r√≥jel!');
            ops.pop();
          } else {
            while (ops.length > 0 && ops[ops.length - 1] !== '(' && getPrecedence(ops[ops.length - 1]) >= getPrecedence(token)) applyOp();
            ops.push(token);
          }
        }
        while (ops.length > 0) {
          if (ops[ops.length-1] === '(') throw new Error('Hi√°nyz√≥ z√°r√≥jel!');
          applyOp();
        }
        if (values.length !== 1 || ops.length !== 0) throw new Error('√ârv√©nytelen kifejez√©s!');
        return values[0];
      }
      try {
        const tokens = tokenize(expressionStr);
        steps.push({text:'Kiindul√≥ kifejez√©s:',visual:{expression:tokens}});
        const finalResult = evaluateExpression(tokens, steps);
        const [simplifiedNum, simplifiedDen] = simplify(finalResult.num, finalResult.den);
        let finalResultDisplay = { num: simplifiedNum, den: simplifiedDen };
        if (finalResult.num !== simplifiedNum || finalResult.den !== simplifiedDen) {
          const commonDivisor = gcd(Math.abs(finalResult.num), Math.abs(finalResult.den));
          steps.push({text:`V√©g√ºl egyszer≈±s√≠tj√ºk a v√©geredm√©nyt a legnagyobb k√∂z√∂s oszt√≥val, ami ${commonDivisor}.`,visual:{expression:[{num:finalResult.num,den:finalResult.den},'=',finalResultDisplay]}});
        }
        steps.push({text:'<span class="fw-bold fs-5">V√©geredm√©ny:</span>',visual:{expression:[finalResultDisplay]}});
      } catch (e) {
        lastSteps = [{text:`Hiba t√∂rt√©nt: ${e.message}`,isError:true}];
        displaySteps(lastSteps);
        return;
      }
      lastSteps = steps;
      await displaySteps(lastSteps);
    }

    // M√≥dv√°lt√≥ logika
    function toggleMode() {
      const modeToggle = document.getElementById('mode-toggle');
      const basicModeInputs = document.getElementById('basic-mode-inputs');
      const advancedModeInput = document.getElementById('advanced-mode-input');
      if (modeToggle.checked) {
        basicModeInputs.classList.add('d-none');
        advancedModeInput.classList.remove('d-none');
        document.getElementById('steps').innerHTML = '';
        lastSteps = null;
      } else {
        basicModeInputs.classList.remove('d-none');
        advancedModeInput.classList.add('d-none');
        document.getElementById('steps').innerHTML = '';
        lastSteps = null;
      }
    }

    // L√©pesek st√≠lus√°nak friss√≠t√©se a t√©ma szerint
    function updateStepsTheme(isDarkMode) {
      const stepsContainer = document.getElementById('steps');
      const stepDivs = stepsContainer.querySelectorAll('.step-box');
      stepDivs.forEach(stepDiv => {
        stepDiv.classList.toggle('dark-mode', isDarkMode);
        const fractionLines = stepDiv.querySelectorAll('.fraction-line');
        fractionLines.forEach(line => {
          line.style.borderColor = isDarkMode ? '#ffd700' : '#1564b3';
        });
      });
    }

	
  </script>
</body>
</html>